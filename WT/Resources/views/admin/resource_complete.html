@extends('WT/admin/layout')

@block('page-content')

@include('WT/admin/resource')

{# Dashboard #}
<div class='ly-row'>

	<div class='page-section page-section-content section-inner'>

		<div class='ly-row'>
			<img class='wt-poster' src='{{\Request::base().$resource -> poster() -> thumb('small')}}'>
			<div class='wt-get-manga-right-img'>
				<h2>{{$resource -> name}}</h2>
				<p>{{$resource -> overview}}</p>
				<p><b>DataBase API</b>: {{$resource -> container -> database_name}} | {{$resource -> container -> id}}</p>
				<p><b>Last update</b>: {{$resource -> container -> database_id}}</p>
			</div>
		</div>

		<div>

			@if($resource -> container -> type == 'series')

				<h2>Episodi</h2>
				<table width='600'>
					<tr>
						<td>Nome dell'episodio</td>
						<td>Source</td>
						<td>Day released</td>
					</tr>
					@foreach($resource -> seasons -> sortBy(['number' => ['direction' => 'ASC','type' => 'number']]) as $season)
						<tr>
							<td colspan='3'>
								<b>Season {{$season -> number}}</b>
							</td>
						</tr>
						@foreach($season -> episodes -> sortBy(['number' => ['direction' => 'ASC','type' => 'number']]) as $episode)
							<tr>
								<td>{{$episode -> number}}. {{$episode -> name}}</td>
								<td><a href='#'><i class='fa fa-external-link'></i>&nbsp;Watch</a></td>
								<td>
									@if($episode -> aired_at)
										{{$episode -> aired_at -> format('d-m-Y')}}
									@else
										Unknow 
									@endif
								</td>
							</tr>
						@endforeach
					@endforeach
				</table>
			@endif

			@if($resource -> container -> type == 'manga')

				<h2>Chapters</h2>
				<table width='600'>
					<tr>
						<td>Chapter name</td>
						<td  style='text-align:right'>Day released</td>
					</tr>
					@foreach($resource -> volumes -> where('number','TBD') -> merge($resource -> volumes -> whereNot('number','TBD') -> sortBy(['number' => ['direction' => 'ASC','type' => 'number']])) as $volume)
						<tr>
							<td colspan='2'>
								<b>Volume {{$volume -> number}}</b>
							</td>
						</tr>
						@foreach($volume -> chapters -> sortBy(['number' => ['direction' => 'ASC','type' => 'number']]) as $chapter)
							<tr>
								<td>
									<a target='_blank' href='{{$chapter -> scan}}'>
										Chapter {{$chapter -> number}} - {{$chapter -> name}}
									</a>
								</td>
								<td style='text-align:right'>
									@if($chapter -> released_at)
										{{$chapter -> released_at -> format('M d, Y')}}
									@else
										Unknow 
									@endif
								</td>
							</tr>
						@endforeach
					@endforeach

				</table>

			@endif




		</div>
	</div>
</div>
@endblock